/*
 * Copyright (c) 2010 Arc90 Inc
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*eslint-env es6:false*/
/*
 * Copyright (c) 2010 Arc90 Inc
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*
 * This code is heavily based on Arc90's readability.js (1.7.1) script
 * available at: http://code.google.com/p/arc90labs-readability
 */
/**
 * Public constructor.
 * @param {HTMLDocument} doc     The document to parse.
 * @param {Object}       options The options object.
 */
function Readability(a,b){if(b&&b.documentElement)a=b,b=arguments[2];else if(!a||!a.documentElement)throw new Error("First argument to Readability constructor should be a document object.");b=b||{},this._doc=a,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._articleSiteName=null,this._attempts=[],this._debug=!!b.debug,this._maxElemsToParse=b.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=b.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=b.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(b.classesToPreserve||[]),this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY;var c;this._debug?(c=function(a){var c,d,b=a.nodeName+" ";return a.nodeType==a.TEXT_NODE?b+'("'+a.textContent+'")':(c=a.className&&"."+a.className.replace(/ /g,"."),d="",a.id?d="(#"+a.id+c+")":c&&(d="("+c+")"),b+d)},this.log=function(){var a,b;"undefined"!=typeof dump?(a=Array.prototype.map.call(arguments,function(a){return a&&a.nodeName?c(a):a}).join(" "),dump("Reader: (Readability) "+a+"\n")):"undefined"!=typeof console&&(b=["Reader: (Readability) "].concat(arguments),console.log.apply(console,b))}):this.log=function(){}}Readability.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|foot|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|foot|footer|footnote|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|tool|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,nextLink:/(next|weiter|continue|>([^\|]|$)|禄([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|芦)/i,whitespace:/^\s*$/,hasContent:/\S$/},DIV_TO_P_ELEMS:["A","BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL","SELECT"],ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],CLASSES_TO_PRESERVE:["page"],_postProcessContent:function(a){this._fixRelativeUris(a),this._cleanClasses(a)},_removeNodes:function(a,b){var c,d,e;for(c=a.length-1;c>=0;c--)d=a[c],e=d.parentNode,e&&(!b||b.call(this,d,c,a))&&e.removeChild(d)},_replaceNodeTags:function(a,b){var c,d;for(c=a.length-1;c>=0;c--)d=a[c],this._setNodeTag(d,b)},_forEachNode:function(a,b){Array.prototype.forEach.call(a,b,this)},_someNode:function(a,b){return Array.prototype.some.call(a,b,this)},_everyNode:function(a,b){return Array.prototype.every.call(a,b,this)},_concatNodeLists:function(){var a=Array.prototype.slice,b=a.call(arguments),c=b.map(function(b){return a.call(b)});return Array.prototype.concat.apply([],c)},_getAllNodesWithTag:function(a,b){return a.querySelectorAll?a.querySelectorAll(b.join(",")):[].concat.apply([],b.map(function(b){var c=a.getElementsByTagName(b);return Array.isArray(c)?c:Array.from(c)}))},_cleanClasses:function(a){var b=this._classesToPreserve,c=(a.getAttribute("class")||"").split(/\s+/).filter(function(a){return-1!=b.indexOf(a)}).join(" ");for(c?a.setAttribute("class",c):a.removeAttribute("class"),a=a.firstElementChild;a;a=a.nextElementSibling)this._cleanClasses(a)},_fixRelativeUris:function(a){function d(a){if(b==c&&"#"==a.charAt(0))return a;try{return new URL(a,b).href}catch(d){}return a}var f,b=this._doc.baseURI,c=this._doc.documentURI,e=this._getAllNodesWithTag(a,["a"]);this._forEachNode(e,function(a){var c,b=a.getAttribute("href");b&&(0===b.indexOf("javascript:")?(c=this._doc.createTextNode(a.textContent),a.parentNode.replaceChild(c,a)):a.setAttribute("href",d(b)))}),f=this._getAllNodesWithTag(a,["img"]),this._forEachNode(f,function(a){var b=a.getAttribute("src");b&&a.setAttribute("src",d(b))})},_getArticleTitle:function(){function f(a){return a.split(/\s+/).length}var e,g,h,i,j,k,a=this._doc,b="",c="";try{b=c=a.title.trim(),"string"!=typeof b&&(b=c=this._getInnerText(a.getElementsByTagName("title")[0]))}catch(d){}return e=!1,/ [\|\-\\\/>禄] /.test(b)?(e=/ [\\\/>禄] /.test(b),b=c.replace(/(.*)[\|\-\\\/>禄] .*/gi,"$1"),f(b)<3&&(b=c.replace(/[^\|\-\\\/>禄]*[\|\-\\\/>禄](.*)/gi,"$1"))):-1!==b.indexOf(": ")?(g=this._concatNodeLists(a.getElementsByTagName("h1"),a.getElementsByTagName("h2")),h=b.trim(),i=this._someNode(g,function(a){return a.textContent.trim()===h}),i||(b=c.substring(c.lastIndexOf(":")+1),f(b)<3?b=c.substring(c.indexOf(":")+1):f(c.substr(0,c.indexOf(":")))>5&&(b=c))):(b.length>150||b.length<15)&&(j=a.getElementsByTagName("h1"),1===j.length&&(b=this._getInnerText(j[0]))),b=b.trim().replace(this.REGEXPS.normalize," "),k=f(b),4>=k&&(!e||k!=f(c.replace(/[\|\-\\\/>禄]+/g,""))-1)&&(b=c),b},_prepDocument:function(){var a=this._doc;this._removeNodes(a.getElementsByTagName("style")),a.body&&this._replaceBrs(a.body),this._replaceNodeTags(a.getElementsByTagName("font"),"SPAN")},_nextElement:function(a){for(var b=a;b&&b.nodeType!=this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(b.textContent);)b=b.nextSibling;return b},_replaceBrs:function(a){this._forEachNode(this._getAllNodesWithTag(a,["br"]),function(a){for(var d,e,f,g,b=a.nextSibling,c=!1;(b=this._nextElement(b))&&"BR"==b.tagName;)c=!0,d=b.nextSibling,b.parentNode.removeChild(b),b=d;if(c){for(e=this._doc.createElement("p"),a.parentNode.replaceChild(e,a),b=e.nextSibling;b&&("BR"!=b.tagName||(f=this._nextElement(b.nextSibling),!f||"BR"!=f.tagName))&&this._isPhrasingContent(b);)g=b.nextSibling,e.appendChild(b),b=g;for(;e.lastChild&&this._isWhitespace(e.lastChild);)e.removeChild(e.lastChild);"P"===e.parentNode.tagName&&this._setNodeTag(e.parentNode,"DIV")}})},_setNodeTag:function(a,b){var c,d;if(this.log("_setNodeTag",a,b),a.__JSDOMParser__)return a.localName=b.toLowerCase(),a.tagName=b.toUpperCase(),a;for(c=a.ownerDocument.createElement(b);a.firstChild;)c.appendChild(a.firstChild);for(a.parentNode.replaceChild(c,a),a.readability&&(c.readability=a.readability),d=0;d<a.attributes.length;d++)try{c.setAttribute(a.attributes[d].name,a.attributes[d].value)}catch(e){}return c},_prepArticle:function(a){var b,c,d,e;this._cleanStyles(a),this._markDataTables(a),this._cleanConditionally(a,"form"),this._cleanConditionally(a,"fieldset"),this._clean(a,"object"),this._clean(a,"embed"),this._clean(a,"h1"),this._clean(a,"footer"),this._clean(a,"link"),this._clean(a,"aside"),b=this.DEFAULT_CHAR_THRESHOLD,this._forEachNode(a.children,function(a){this._cleanMatchedNodes(a,function(a,c){return/share/.test(c)&&a.textContent.length<b})}),c=a.getElementsByTagName("h2"),1===c.length&&(d=(c[0].textContent.length-this._articleTitle.length)/this._articleTitle.length,Math.abs(d)<.5&&(e=!1,e=d>0?c[0].textContent.includes(this._articleTitle):this._articleTitle.includes(c[0].textContent),e&&this._clean(a,"h2"))),this._clean(a,"iframe"),this._clean(a,"input"),this._clean(a,"textarea"),this._clean(a,"select"),this._clean(a,"button"),this._cleanHeaders(a),this._cleanConditionally(a,"table"),this._cleanConditionally(a,"ul"),this._cleanConditionally(a,"div"),this._removeNodes(a.getElementsByTagName("p"),function(a){var b=a.getElementsByTagName("img").length,c=a.getElementsByTagName("embed").length,d=a.getElementsByTagName("object").length,e=a.getElementsByTagName("iframe").length,f=b+c+d+e;return 0===f&&!this._getInnerText(a,!1)}),this._forEachNode(this._getAllNodesWithTag(a,["br"]),function(a){var b=this._nextElement(a.nextSibling);b&&"P"==b.tagName&&a.parentNode.removeChild(a)}),this._forEachNode(this._getAllNodesWithTag(a,["table"]),function(a){var c,d,b=this._hasSingleTagInsideElement(a,"TBODY")?a.firstElementChild:a;this._hasSingleTagInsideElement(b,"TR")&&(c=b.firstElementChild,this._hasSingleTagInsideElement(c,"TD")&&(d=c.firstElementChild,d=this._setNodeTag(d,this._everyNode(d.childNodes,this._isPhrasingContent)?"P":"DIV"),a.parentNode.replaceChild(d,a)))})},_initializeNode:function(a){switch(a.readability={contentScore:0},a.tagName){case"DIV":a.readability.contentScore+=5;break;case"PRE":case"TD":case"BLOCKQUOTE":a.readability.contentScore+=3;break;case"ADDRESS":case"OL":case"UL":case"DL":case"DD":case"DT":case"LI":case"FORM":a.readability.contentScore-=3;break;case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"TH":a.readability.contentScore-=5}a.readability.contentScore+=this._getClassWeight(a)},_removeAndGetNext:function(a){var b=this._getNextNode(a,!0);return a.parentNode.removeChild(a),b},_getNextNode:function(a,b){if(!b&&a.firstElementChild)return a.firstElementChild;if(a.nextElementSibling)return a.nextElementSibling;do a=a.parentNode;while(a&&!a.nextElementSibling);return a&&a.nextElementSibling},_checkByline:function(a,b){var c,d;return this._articleByline?!1:(void 0!==a.getAttribute&&(c=a.getAttribute("rel"),d=a.getAttribute("itemprop")),("author"===c||d&&-1!==d.indexOf("author")||this.REGEXPS.byline.test(b))&&this._isValidByline(a.textContent)?(this._articleByline=a.textContent.trim(),!0):!1)},_getNodeAncestors:function(a,b){b=b||0;for(var c=0,d=[];a.parentNode&&(d.push(a.parentNode),!b||++c!==b);)a=a.parentNode;return d},_grabArticle:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V;if(this.log("**** grabArticle ****"),b=this._doc,c=null!==a?!0:!1,a=a?a:this._doc.body,!a)return this.log("No body found in document. Abort."),null;for(d=a.innerHTML;;){for(e=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),f=[],g=this._doc.documentElement;g;)if(h=g.className+" "+g.id,this._isProbablyVisible(g))if(this._checkByline(g,h))g=this._removeAndGetNext(g);else if(!e||!this.REGEXPS.unlikelyCandidates.test(h)||this.REGEXPS.okMaybeItsACandidate.test(h)||this._hasAncestorTag(g,"table")||"BODY"===g.tagName||"A"===g.tagName)if("DIV"!==g.tagName&&"SECTION"!==g.tagName&&"HEADER"!==g.tagName&&"H1"!==g.tagName&&"H2"!==g.tagName&&"H3"!==g.tagName&&"H4"!==g.tagName&&"H5"!==g.tagName&&"H6"!==g.tagName||!this._isElementWithoutContent(g)){if(-1!==this.DEFAULT_TAGS_TO_SCORE.indexOf(g.tagName)&&f.push(g),"DIV"===g.tagName){for(i=null,j=g.firstChild;j;){if(k=j.nextSibling,this._isPhrasingContent(j))null!==i?i.appendChild(j):this._isWhitespace(j)||(i=b.createElement("p"),g.replaceChild(i,j),i.appendChild(j));else if(null!==i){for(;i.lastChild&&this._isWhitespace(i.lastChild);)i.removeChild(i.lastChild);i=null}j=k}this._hasSingleTagInsideElement(g,"P")&&this._getLinkDensity(g)<.25?(l=g.children[0],g.parentNode.replaceChild(l,g),g=l,f.push(g)):this._hasChildBlockElement(g)||(g=this._setNodeTag(g,"P"),f.push(g))}g=this._getNextNode(g)}else g=this._removeAndGetNext(g);else this.log("Removing unlikely candidate - "+h),g=this._removeAndGetNext(g);else this.log("Removing hidden node - "+h),g=this._removeAndGetNext(g);for(m=[],this._forEachNode(f,function(a){var b,c,d;a.parentNode&&"undefined"!=typeof a.parentNode.tagName&&(b=this._getInnerText(a),b.length<25||(c=this._getNodeAncestors(a,3),0!==c.length&&(d=0,d+=1,d+=b.split(",").length,d+=Math.min(Math.floor(b.length/100),3),this._forEachNode(c,function(a,b){if(a.tagName&&a.parentNode&&"undefined"!=typeof a.parentNode.tagName){if("undefined"==typeof a.readability&&(this._initializeNode(a),m.push(a)),0===b)var c=1;else c=1===b?2:3*b;a.readability.contentScore+=d/c}}))))}),n=[],o=0,p=m.length;p>o;o+=1)for(q=m[o],r=q.readability.contentScore*(1-this._getLinkDensity(q)),q.readability.contentScore=r,this.log("Candidate:",q,"with score "+r),s=0;s<this._nbTopCandidates;s++)if(t=n[s],!t||r>t.readability.contentScore){n.splice(s,0,q),n.length>this._nbTopCandidates&&n.pop();break}if(u=n[0]||null,v=!1,null===u||"BODY"===u.tagName){for(u=b.createElement("DIV"),v=!0,x=a.childNodes;x.length;)this.log("Moving child out:",x[0]),u.appendChild(x[0]);a.appendChild(u),this._initializeNode(u)}else if(u){for(y=[],z=1;z<n.length;z++)n[z].readability.contentScore/u.readability.contentScore>=.75&&y.push(this._getNodeAncestors(n[z]));if(A=3,y.length>=A)for(w=u.parentNode;"BODY"!==w.tagName;){for(B=0,C=0;C<y.length&&A>B;C++)B+=Number(y[C].includes(w));if(B>=A){u=w;break}w=w.parentNode}for(u.readability||this._initializeNode(u),w=u.parentNode,D=u.readability.contentScore,E=D/3;"BODY"!==w.tagName;)if(w.readability){if(F=w.readability.contentScore,E>F)break;if(F>D){u=w;break}D=w.readability.contentScore,w=w.parentNode}else w=w.parentNode;for(w=u.parentNode;"BODY"!=w.tagName&&1==w.children.length;)u=w,w=u.parentNode;u.readability||this._initializeNode(u)}for(G=b.createElement("DIV"),c&&(G.id="readability-content"),H=Math.max(10,.2*u.readability.contentScore),w=u.parentNode,I=w.children,J=0,K=I.length;K>J;J++)L=I[J],M=!1,this.log("Looking at sibling node:",L,L.readability?"with score "+L.readability.contentScore:""),this.log("Sibling has score",L.readability?L.readability.contentScore:"Unknown"),L===u?M=!0:(N=0,L.className===u.className&&""!==u.className&&(N+=.2*u.readability.contentScore),L.readability&&L.readability.contentScore+N>=H?M=!0:"P"===L.nodeName&&(O=this._getLinkDensity(L),P=this._getInnerText(L),Q=P.length,Q>80&&.25>O?M=!0:80>Q&&Q>0&&0===O&&-1!==P.search(/\.( |$)/)&&(M=!0))),M&&(this.log("Appending node:",L),-1===this.ALTER_TO_DIV_EXCEPTIONS.indexOf(L.nodeName)&&(this.log("Altering sibling:",L,"to div."),L=this._setNodeTag(L,"DIV")),G.appendChild(L),J-=1,K-=1);if(this._debug&&this.log("Article content pre-prep: "+G.innerHTML),this._prepArticle(G),this._debug&&this.log("Article content post-prep: "+G.innerHTML),v)u.id="readability-page-1",u.className="page";else{for(R=b.createElement("DIV"),R.id="readability-page-1",R.className="page",S=G.childNodes;S.length;)R.appendChild(S[0]);G.appendChild(R)}if(this._debug&&this.log("Article content after paging: "+G.innerHTML),T=!0,U=this._getInnerText(G,!0).length,U<this._charThreshold)if(T=!1,a.innerHTML=d,this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS),this._attempts.push({articleContent:G,textLength:U});else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES),this._attempts.push({articleContent:G,textLength:U});else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY),this._attempts.push({articleContent:G,textLength:U});else{if(this._attempts.push({articleContent:G,textLength:U}),this._attempts.sort(function(a,b){return b.textLength-a.textLength}),!this._attempts[0].textLength)return null;G=this._attempts[0].articleContent,T=!0}if(T)return V=[w,u].concat(this._getNodeAncestors(w)),this._someNode(V,function(a){if(!a.tagName)return!1;var b=a.getAttribute("dir");return b?(this._articleDir=b,!0):!1}),G}},_isValidByline:function(a){return"string"==typeof a||a instanceof String?(a=a.trim(),a.length>0&&a.length<100):!1},_getArticleMetadata:function(){var a={},b={},c=this._doc.getElementsByTagName("meta"),d=/\s*(dc|dcterm|og|twitter)\s*:\s*(author|creator|description|title|site_name)\s*/gi,e=/^\s*(?:(dc|dcterm|og|twitter|weibo:(article|webpage))\s*[\.:]\s*)?(author|creator|description|title|site_name)\s*$/i;return this._forEachNode(c,function(a){var h,i,j,c=a.getAttribute("name"),f=a.getAttribute("property"),g=a.getAttribute("content");if(g){if(h=null,i=null,f&&(h=f.match(d)))for(j=h.length-1;j>=0;j--)i=h[j].toLowerCase().replace(/\s/g,""),b[i]=g.trim();!h&&c&&e.test(c)&&(i=c,g&&(i=i.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),b[i]=g.trim()))}}),a.title=b["dc:title"]||b["dcterm:title"]||b["og:title"]||b["weibo:article:title"]||b["weibo:webpage:title"]||b["title"]||b["twitter:title"],a.title||(a.title=this._getArticleTitle()),a.byline=b["dc:creator"]||b["dcterm:creator"]||b["author"],a.excerpt=b["dc:description"]||b["dcterm:description"]||b["og:description"]||b["weibo:article:description"]||b["weibo:webpage:description"]||b["description"]||b["twitter:description"],a.siteName=b["og:site_name"],a},_removeScripts:function(a){this._removeNodes(a.getElementsByTagName("script"),function(a){return a.nodeValue="",a.removeAttribute("src"),!0}),this._removeNodes(a.getElementsByTagName("noscript"))},_hasSingleTagInsideElement:function(a,b){return 1!=a.children.length||a.children[0].tagName!==b?!1:!this._someNode(a.childNodes,function(a){return a.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(a.textContent)})},_isElementWithoutContent:function(a){return a.nodeType===this.ELEMENT_NODE&&0==a.textContent.trim().length&&(0==a.children.length||a.children.length==a.getElementsByTagName("br").length+a.getElementsByTagName("hr").length)},_hasChildBlockElement:function(a){return this._someNode(a.childNodes,function(a){return-1!==this.DIV_TO_P_ELEMS.indexOf(a.tagName)||this._hasChildBlockElement(a)})},_isPhrasingContent:function(a){return a.nodeType===this.TEXT_NODE||-1!==this.PHRASING_ELEMS.indexOf(a.tagName)||("A"===a.tagName||"DEL"===a.tagName||"INS"===a.tagName)&&this._everyNode(a.childNodes,this._isPhrasingContent)},_isWhitespace:function(a){return a.nodeType===this.TEXT_NODE&&0===a.textContent.trim().length||a.nodeType===this.ELEMENT_NODE&&"BR"===a.tagName},_getInnerText:function(a,b){b="undefined"==typeof b?!0:b;var c=a.textContent.trim();return b?c.replace(this.REGEXPS.normalize," "):c},_getCharCount:function(a,b){return b=b||",",this._getInnerText(a).split(b).length-1},_cleanStyles:function(a){var b,c;if(a&&"svg"!==a.tagName.toLowerCase()){for(b=0;b<this.PRESENTATIONAL_ATTRIBUTES.length;b++)a.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[b]);for(-1!==this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.indexOf(a.tagName)&&(a.removeAttribute("width"),a.removeAttribute("height")),c=a.firstElementChild;null!==c;)this._cleanStyles(c),c=c.nextElementSibling}},_getLinkDensity:function(a){var c,b=this._getInnerText(a).length;return 0===b?0:(c=0,this._forEachNode(a.getElementsByTagName("a"),function(a){c+=this._getInnerText(a).length}),c/b)},_getClassWeight:function(a){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var b=0;return"string"==typeof a.className&&""!==a.className&&(this.REGEXPS.negative.test(a.className)&&(b-=25),this.REGEXPS.positive.test(a.className)&&(b+=25)),"string"==typeof a.id&&""!==a.id&&(this.REGEXPS.negative.test(a.id)&&(b-=25),this.REGEXPS.positive.test(a.id)&&(b+=25)),b},_clean:function(a,b){var c=-1!==["object","embed","iframe"].indexOf(b);this._removeNodes(a.getElementsByTagName(b),function(a){if(c){for(var b=0;b<a.attributes.length;b++)if(this.REGEXPS.videos.test(a.attributes[b].value))return!1;if("object"===a.tagName&&this.REGEXPS.videos.test(a.innerHTML))return!1}return!0})},_hasAncestorTag:function(a,b,c,d){c=c||3,b=b.toUpperCase();for(var e=0;a.parentNode;){if(c>0&&e>c)return!1;if(a.parentNode.tagName===b&&(!d||d(a.parentNode)))return!0;a=a.parentNode,e++}return!1},_getRowAndColumnCount:function(a){var e,f,g,h,i,j,b=0,c=0,d=a.getElementsByTagName("tr");for(e=0;e<d.length;e++){for(f=d[e].getAttribute("rowspan")||0,f&&(f=parseInt(f,10)),b+=f||1,g=0,h=d[e].getElementsByTagName("td"),i=0;i<h.length;i++)j=h[i].getAttribute("colspan")||0,j&&(j=parseInt(j,10)),g+=j||1;c=Math.max(c,g)}return{rows:b,columns:c}},_markDataTables:function(a){var c,d,e,f,g,h,i,j,k,b=a.getElementsByTagName("table");for(c=0;c<b.length;c++)d=b[c],e=d.getAttribute("role"),"presentation"!=e?(f=d.getAttribute("datatable"),"0"!=f?(g=d.getAttribute("summary"),g?d._readabilityDataTable=!0:(h=d.getElementsByTagName("caption")[0],h&&h.childNodes.length>0?d._readabilityDataTable=!0:(i=["col","colgroup","tfoot","thead","th"],j=function(a){return!!d.getElementsByTagName(a)[0]},i.some(j)?(this.log("Data table because found data-y descendant"),d._readabilityDataTable=!0):d.getElementsByTagName("table")[0]?d._readabilityDataTable=!1:(k=this._getRowAndColumnCount(d),d._readabilityDataTable=k.rows>=10||k.columns>4?!0:k.rows*k.columns>10)))):d._readabilityDataTable=!1):d._readabilityDataTable=!1},_cleanConditionally:function(a,b){if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)){var c="ul"===b||"ol"===b;this._removeNodes(a.getElementsByTagName(b),function(a){var e,f,g,h,i,j,k,l,m,n,o,p,q,d=function(a){return a._readabilityDataTable};if("table"===b&&d(a))return!1;if(this._hasAncestorTag(a,"table",-1,d))return!1;if(e=this._getClassWeight(a),f=0,this.log("Cleaning Conditionally",a),0>e+f)return!0;if(this._getCharCount(a,",")<10){for(g=a.getElementsByTagName("p").length,h=a.getElementsByTagName("img").length,i=a.getElementsByTagName("li").length-100,j=a.getElementsByTagName("input").length,k=0,l=this._concatNodeLists(a.getElementsByTagName("object"),a.getElementsByTagName("embed"),a.getElementsByTagName("iframe")),m=0;m<l.length;m++){for(n=0;n<l[m].attributes.length;n++)if(this.REGEXPS.videos.test(l[m].attributes[n].value))return!1;if("object"===l[m].tagName&&this.REGEXPS.videos.test(l[m].innerHTML))return!1;k++}return o=this._getLinkDensity(a),p=this._getInnerText(a).length,q=h>1&&.5>g/h&&!this._hasAncestorTag(a,"figure")||!c&&i>g||j>Math.floor(g/3)||!c&&25>p&&(0===h||h>2)&&!this._hasAncestorTag(a,"figure")||!c&&25>e&&o>.2||e>=25&&o>.5||1===k&&75>p||k>1}return!1})}},_cleanMatchedNodes:function(a,b){for(var c=this._getNextNode(a,!0),d=this._getNextNode(a);d&&d!=c;)d=b(d,d.className+" "+d.id)?this._removeAndGetNext(d):this._getNextNode(d)},_cleanHeaders:function(a){for(var b=1;3>b;b+=1)this._removeNodes(a.getElementsByTagName("h"+b),function(a){return this._getClassWeight(a)<0})},_flagIsActive:function(a){return(this._flags&a)>0},_removeFlag:function(a){this._flags=this._flags&~a},_isProbablyVisible:function(a){return!(a.style&&"none"==a.style.display||a.hasAttribute("hidden"))},parse:function(){var a,b,c,d,e;if(this._maxElemsToParse>0&&(a=this._doc.getElementsByTagName("*").length,a>this._maxElemsToParse))throw new Error("Aborting parsing document; "+a+" elements found");return this._removeScripts(this._doc),this._prepDocument(),b=this._getArticleMetadata(),this._articleTitle=b.title,(c=this._grabArticle())?(this.log("Grabbed: "+c.innerHTML),this._postProcessContent(c),b.excerpt||(d=c.getElementsByTagName("p"),d.length>0&&(b.excerpt=d[0].textContent.trim())),e=c.textContent,{title:this._articleTitle,byline:b.byline||this._articleByline,dir:this._articleDir,content:c.innerHTML,textContent:e,length:e.length,excerpt:b.excerpt,siteName:b.siteName||this._articleSiteName}):null}};

export {
    Readability as Readability
}